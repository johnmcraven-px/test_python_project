# Start from the Ubuntu base image
FROM ubuntu:22.04

# Switch to root user
USER root

# add a non-root user called openfoam
RUN useradd -ms /bin/bash openfoam

# Create necessary directories and set ownership to openfoam user
RUN mkdir -p /opt/OpenFOAM && chown -R openfoam:openfoam /opt/OpenFOAM

# Switch to a non-root user if necessary
USER openfoam

# Install necessary dependencies and extract OpenFOAM
RUN apt-get update && apt-get install -y wget ca-certificates && apt-get clean \
    && wget -O /tmp/OpenFOAM-v2406.tgz https://dl.openfoam.com/source/v2406/OpenFOAM-v2406.tgz \
    && tar -xzf /tmp/OpenFOAM-v2406.tgz -C /opt/OpenFOAM \
    && rm /tmp/OpenFOAM-v2406.tgz

# Set up environment variables
RUN echo "source /opt/OpenFOAM/OpenFOAM-v2406/etc/bashrc" >> /home/openfoam/.bashrc

# Set the working directory
WORKDIR /home/openfoam

# Copy the local directory to the container
COPY . /home/openfoam/case

# Set entrypoint to bash
ENTRYPOINT ["/bin/bash"]
